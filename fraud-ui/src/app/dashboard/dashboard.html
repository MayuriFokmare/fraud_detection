<div class="dashboard-container">
  <!-- Top Heading -->
  <div class="username-container">
    <span class="username">Fraud Analysis Dashboard Of {{ username }}</span>
  </div>

  <!-- Top Row -->
  <div class="top-row">
    <!-- ===== PRE-DETECTION: Merchant overview (cards + donut) ===== -->
                         <br><br><br><br><br>

    <div class="merchant-overview" *ngIf="!summary && merchantSummary">
      <!-- Cards -->
      <div class="cards">

        <div class="card">
          <span class="key">Merchant</span>
          <span class="val">{{ merchantSummary.merchant_name }}</span>
        </div>
        <div class="card">
          <span class="key">Total Transactions</span>
          <span class="val">{{ merchantSummary.totalTransactions }}</span>
        </div>
      </div>

      <!-- Donut -->
      <div class="donut-container">

        <canvas id="merchantDonutChart"></canvas>
      </div>
      <div class="form-container">
      <div class="controls">
        <label for="fraudType">Select Fraud Type</label>
        <select id="fraudType" [(ngModel)]="fraudType">
          <option *ngFor="let type of fraudTypes" [value]="type">{{ type }}</option>
        </select>

        <label for="fileUpload">Upload File</label>
        <input id="fileUpload" type="file" (change)="onFileSelected($event)" />

        <button (click)="runDetection()" [disabled]="loading">
          {{ loading ? 'Running...' : 'RUN DETECTION' }}
        </button>
      </div>
    </div>
    </div>

    <!-- ===== POST-DETECTION: Donut (summary) ===== -->
    <div class="donut-container" *ngIf="summary">
      <canvas id="donutChart"></canvas>
    </div>

    <!-- ===== POST-DETECTION: Cards (summary) ===== -->
    <div class="cards" *ngIf="summary">
      <div class="card">
        <span class="key">Fraud Type</span>
        <span class="val">{{ summary.fraud_type }}</span>
      </div>
      <div class="card">
        <span class="key">Total Transactions</span>
        <span class="val">{{ summary.total_transactions }}</span>
      </div>
      <div class="card">
        <span class="key">Fraud %</span>
        <span class="val">{{ summary.fraud_percentage }}%</span>
      </div>
      <div class="card">
        <span class="key">Total Fraud </span>
        <span class="val">{{ summary.total_fraud }}%</span>
      </div>
    </div>

    
  </div>

  <!-- ===== PRE-DETECTION: Fraud summary table (nice) ===== -->
  <div class="fraud-summary" *ngIf="!summary && merchantSummary">
    <table class="fraud-summary-table">
  <thead>
    <tr>
      <th>Fraud Type</th>
      <th>Total</th>
      <th>Fraudulent</th>
      <th>Non-Fraudulent</th>
      <th>Fraud %</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let row of merchantSummary.fraud_summary">
      <td>{{ row.fraud_type | titlecase }}</td>
      <td>{{ row.total_transactions }}</td>
      <td>
        <span class="tag danger">{{ row.fraudulent }}</span>
      </td>
      <td>
        <span class="tag success">{{ row.non_fraudulent }}</span>
      </td>
      <td>{{ row.fraud_percentage }}%</td>
    </tr>
  </tbody>
</table>

  </div>

  <!-- ===== POST-DETECTION: Bottom Row ===== -->
  <div class="bottom-row" *ngIf="summary">
    <!-- Comparison chart -->
    <div class="comparison" *ngIf="summary.fraud_type === 'merchant' || summary.fraud_type === 'payment'">
      <h3>{{ summary.fraud_type | titlecase }} Fraud Comparison</h3>
      <canvas id="barChart"></canvas>
    </div>

    <!-- Transactions Table -->
    <div class="transactions-table" *ngIf="transactions.length > 0">
      <div class="table-header">
    <h3>{{ summary.fraud_type | titlecase }} Transactions</h3>
    <button class="btn export" (click)="exportCSV()">Export CSV</button>
  </div>
      <p-table
        [value]="transactions"
        [paginator]="true"
        [rows]="6"
        responsiveLayout="scroll"
        [showPageLinks]="false"
      >
        <ng-template pTemplate="header">
          <tr>
            <th>Transaction ID</th>
            <th>Captured Text</th>
            <th>Status</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-row>
  <tr [ngClass]="{ 'fraud-row': row.status === 'Fraud' }">
    <td>{{ row.transaction_id }}</td>
    <td>{{ row.captured_text }}</td>
    <td>{{ row.status }}</td>
  </tr>
</ng-template>
      </p-table>

    </div>

  </div>
              <button class="btn close" (click)="closeDashboard()" *ngIf="summary">Close Dashboard</button>

</div>
